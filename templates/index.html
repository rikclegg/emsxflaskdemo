<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Test EasyMSX+Flask</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
  </head>
  <body>
    <div id="emsx">
      <div>
        Teams
        <ul>
          <li v-for="team in teams">
            {{ team.teamname }}
          </li>
        </ul>
      </div>

      <div>
        Brokers
        <ul>
          <li v-for="broker in brokers">
            {{ broker.brokername }}
          </li>
        </ul>
      </div>

      <div>
        Orders
        <ul>
          <li v-for="order in orders">
            {{ order.sequence }}   {{ order.ticker }}
          </li>
        </ul>
      </div>

      <div>
        Routes
        <ul>
          <li v-for="route in routes">
            {{ route.sequence }}   {{ route.routeid }}   {{ route.amount }}
          </li>
        </ul>
      </div>
    </div>
  </body>

  <script>

    var emsx = new Vue({
      el: '#emsx',
      data: {
        teams: [],
        brokers: [],
        orders: [],
        routes: [],
        eventdata: {}
      }
    })

    var socket = io.connect('http://' + document.domain + ':' + location.port+"/emsx");
    // verify our websocket connection is established
    socket.on('connect', function() {
        console.log('Websocket connected!');
        socket.emit("create","");
    });

    socket.on('teamlist', function(msg) {
      for (var i = 0; i < msg.length; i++) {
        console.log("TEAM: " + msg[i]);
        Vue.set(emsx.teams, emsx.teams.length, {"teamname":msg[i]});
      }
    });

    socket.on('brokerlist', function(msg) {
      for (var i = 0; i < msg.length; i++) {
        console.log("BROKER: " + msg[i]);
        Vue.set(emsx.brokers, emsx.brokers.length, {"brokername":msg[i]});
      }
    });

    socket.on('emsxevent', function(msg) {
     //console.log("EVENT: " + JSON.stringify(msg));
      console.log("Event>>>");
      for(var fc in msg) {
        field = msg[fc]
        old =  ((field.old_value=="")?"empty":field.old_value)
        console.log(field.name + " has changed from " + old + " to " + field.new_value);
      }
      //emsx.eventdata=msg[0];
      //for(var property in msg[0]) {
      //  console.log(property + "=" + msg[0][property]);
      //}      
      //fieldnames = Object.keys(msg[0]);
      //console.log("Fieldnames: " + fieldnames)
      //console.log("Fieldname: " + fieldnames[0]);
    });

    socket.emit('get_teamlist');
    socket.emit('get_brokerlist');

  </script>
</html>